<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>TETRIS - Labo 2</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
    <main>
<header id="title-block-header">
    <nav>
        <a href="/"><i class="fa fa-angle-left"></i> Back</a>
      </nav>
<h1 class="title">TETRIS - Labo 2</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#informations-générales"
id="toc-informations-générales">Informations Générales</a></li>
<li><a href="#lien-avec-le-précédent-labo"
id="toc-lien-avec-le-précédent-labo">Lien avec le précédent
labo</a></li>
<li><a href="#ajouts-de-ce-labo" id="toc-ajouts-de-ce-labo">Ajouts de ce
labo</a>
<ul>
<li><a href="#interactions" id="toc-interactions">Interactions</a>
<ul>
<li><a href="#échecs-dinteraction" id="toc-échecs-dinteraction">Échecs
d’interaction</a></li>
</ul></li>
<li><a href="#messages" id="toc-messages">Messages</a></li>
<li><a href="#tests" id="toc-tests">Tests</a></li>
</ul></li>
<li><a href="#installation-et-lancement"
id="toc-installation-et-lancement">Installation et lancement</a></li>
<li><a href="#travail-à-réaliser" id="toc-travail-à-réaliser">Travail à
réaliser</a></li>
</ul>
</nav>
<!--

# Changelog

| Date  | Changement                                                                                                          |
| ----- | ------------------------------------------------------------------------------------------------------------------- |
| 03.10 | [Précision](#change_overlap) : deux pièces tombantes sont autorisées à se superposer.                               |

-->
<h1 id="informations-générales">Informations Générales</h1>
<ul>
<li><strong>Date du rendu :</strong> Mardi 17 octobre, 13:15 CEST</li>
<li><strong>Groupes</strong> : À réaliser seul ou à deux, en reprenant
de préférence les groupes du labo 1.</li>
<li><strong>Plagiat</strong> : en cas de copie manifeste, vous y serez
confrontés, vous obtiendrez la note de 1, et l’incident sera reporté au
responsable de la filière, avec un risque d’échec critique immédiat au
cours. Ne trichez pas. <em>(Notez que les IAs génératives se trouvent
aujourd’hui dans une zone qui est encore juridiquement floue pour ce qui
est du plagiat, mais des arguments se valent à en considérer
l’utilisation comme tel. Quoi qu’il en soit, nous vous proposons une
autre vision sur la question : votre ambition est d’apprendre et
d’acquérir des compétences, et votre utilisation éventuelle de cet outil
doit refléter ceci. Tout comme Stackoverflow peut être à la fois un
outil d’enrichissement et une banque de copy-paste, faites un choix
intentionnel et réfléchi, vos propres intérêts en tête, de l’outil que
vous ferez de l’IA générative)</em></li>
</ul>
<h1 id="lien-avec-le-précédent-labo">Lien avec le précédent labo</h1>
<p>Ce labo est une suite du premier labo sur Tetris. Toutes les
informations données dans <a href="./labo-2-tetris-1.md">l’énoncé du
premier labo</a> restent donc valables pour celui-ci.</p>
<p>Au moment de rejoindre ce nouvel assignment sur <a
href="https://classroom.github.com/a/ASCN06le">Github Classroom</a>, un
nouveau repo sera créé, pour lequel nous vous demandons de réutiliser
les mêmes équipes. Ce nouveau repo reprend la correction du précédent
labo et y ajoute les TODOs de ce labo-ci. Si vous souhaitez réutiliser
votre code du premier labo, au lieu de celui fourni, vous pouvez le
faire en exécutant les commandes suivantes :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> remote add lab1 <span class="op">&lt;</span>tetris1-repo-url<span class="op">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> fetch <span class="at">--all</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> merge <span class="at">-e</span> lab1/main <span class="at">--allow-unrelated-histories</span></span></code></pre></div>
<p>Une fois les conflits du merge résolus, vous aurez donc votre
solution au précédent labo avec les ajouts que nous vous fournissons
pour celui-ci. Vérifiez tout de même de ne pas avoir supprimé de tests
ou de TODOs par erreur durant le merge.</p>
<h1 id="ajouts-de-ce-labo">Ajouts de ce labo</h1>
<p>Dans ce labo, vous implémenterez l’interaction avec l’utilisateur ou
l’utilisatrice, et commencerez à mettre en place le protocole de
communication entre le client et le serveur.</p>
<h2 id="interactions">Interactions</h2>
<p>Vous êtes chargés de mettre en place la gestion des événements
permettant l’interaction avec le jeu. L’interface choisie est la
suivante, et s’applique sur la pièce tombante de l’utilisateur ou
l’utilisatrice actuelle. Étant donné que l’aspect multijoueur ne sera
implémenté que dans le prochain labo, vous pouvez pour l’instant
considérer que l’utilisateur ou l’utilisatrice actuelle est toujours le
joueur ou la joueuse dont l’identifiant est 1.</p>
<ul>
<li>Les touches <code>→</code> et <code>←</code> permettent de faire
tourner la pièce tombante dans le sens horaire et anti-horaire,
respectivement.</li>
<li>La touche <code>↓</code> permet de “drop” la pièce tombante,
c’est-à-dire de la faire descendre aussi bas qu’elle le peut puis la
poser.</li>
<li>Le clic gauche de la souris sur le canvas a le même effet que la
touche <code>↓</code>.</li>
<li>Le déplacement de la pièce sur la grille se fait en suivant la
souris. En d’autres termes, lorsque la souris bouge sur le canvas, la
pièce doit être déplacée de manière à ce que son origine se trouve sur
la colonne actuellement survolée par la souris. Notez que la ligne de la
pièce reste régie par les steps du jeu, et ne dépend donc pas de la
souris.</li>
</ul>
<p>Remarquons que cette interface est peu commune pour un Tetris, qui
utilise plus habituellement les touches <code>←</code> et <code>→</code>
pour déplacer la pièce. Ce choix est dans le but de vous faire utiliser
les événements de souris et ses coordonnées. Toutefois, vous êtes libres
d’ajouter d’autres manières d’interagir avec le jeu, par exemple
<code>a</code> et <code>d</code> pour les déplacements, <code>q</code>
et <code>e</code> pour la rotation, et <code>s</code> pour le drop. Il
est simplement nécessaire que les interactions décrites ci-dessus soient
implémentées, et qu’aucune signature de fonction ne soit modifiée
autrement que par l’ajout d’arguments optionnels en fin de liste.</p>
<h3 id="échecs-dinteraction">Échecs d’interaction</h3>
<p>Pour toute requête de déplacement ou de rotation d’une pièce,
celle-ci peut échouer. La raison sera toujours que le résultat de
l’interaction n’est pas valide parce que la pièce se retrouve en dehors
de la grille ou superposée à un bloc posé. Bien que le jeu originel,
dans le cas d’une rotation impossible, tente de déplacer la pièce pour
permettre la rotation, nous nous contenterons ici de la faire échouer.
Une rotation ou un déplacement échoué signifie simplement que la requête
sera ignorée.</p>
<p>Notons que nous considérons comme valide une pièce dont l’un des
blocs se trouve en dehors de la limite supérieure de la grille. Cela
signifie qu’une pièce se trouvant au sommet de la carte a le droit
d’être tournée, même si cela causerait l’un de ses blocs à sortir de la
carte par le haut. Ce choix est fait dans le but de permettre à une
pièce d’être tournée dès son ajout au jeu.</p>
<h2 id="messages">Messages</h2>
<p>Dans ce labo, tout comme dans le précédent, toute la logique du jeu
sera exécutée sur le client. Cette logique sera, dans le labo suivant,
déplacée sur le serveur, et il sera alors nécessaire pour le client de
lui communiquer les requêtes de déplacement, rotation et drop de pièces
à travers le réseau. En retour, le serveur devra envoyer les résultats
de ces interactions, ainsi que les autres évolutions du jeu, à tous les
clients connectés pour qu’ils actualisent leur affichage. Tout ceci se
fera par l’intermédiaire de messages, dont nous allons implémenter une
partie dans ce labo.</p>
<p>En effet, bien que ce ne soit pas encore nécessaire, mais dans le but
de commencer la mise en place de ce système, nous allons déjà
implémenter une partie du protocole de communication et l’utiliser pour
interagir avec la classe <code>Game</code>. Toutes les interactions de
l’utilisateur ou l’utilisatrice devront donc être communiquées à la
classe <code>Game</code> par l’intermédiaire de messages passés à la
méthode <code>onMessage</code>, et non d’appels directs aux fonctions
dédiées telles que <code>moveShape</code> ou <code>rotateShape</code>,
qui sont toutes trois de nouvelles méthodes de la classe
<code>Game</code> à implémenter pour ce labo.</p>
<p>Les messages représentant ces interactions sont modelés par des
classes dans le fichier <code>messages.js</code>. Ce fichier sera
ensuite complété avec les réponses du serveur dans le prochain labo.</p>
<h2 id="tests">Tests</h2>
<p>Il vous est demandé d’implémenter un test pour l’interaction de la
souris avec le jeu. Ce test se trouve dans
<code>inputListener.js</code>, et vérifie que le client ne génère pas
une quantité inutilement excessive de messages lorsque la souris bouge
sans changer de colonne. En effet, il n’est pas nécessaire de générer un
nouveau message à chaque déplacement de la souris, si celle-ci se trouve
dans la même colonne que la colonne actuelle de la pièce. Votre test
devra donc vérifier que, en cas de plusieurs évènements successifs de
déplacement de la souris, un message soit généré uniquement lorsque la
souris entre une nouvelle colonne. Il pourra aussi être bienvenu de
tester que la colonne contenue dans le message généré est correcte.</p>
<p>Comme pour le labo précédent, les tests fournis serviront à noter
votre travail, mais nous pourrons les compléter par des tests
supplémentaires ou une évaluation manuelle si nous le jugeons pertinent.
Nous vous encourageons donc à rajouter des tests, par exemple si vous
ajoutez de nouvelles méthodes, si vous remarquez un cas limite que vous
aimeriez vérifier programmatiquement, ou encore si vous venez de
résoudre un bug dans votre code et aimeriez éviter toute <a
href="https://fr.wikipedia.org/wiki/Test_de_r%C3%A9gression">régression</a>
dans le futur.</p>
<h1 id="installation-et-lancement">Installation et lancement</h1>
<p>Les mêmes instructions que pour le labo précédent sont valables ici.
Exécutez <code>npm install</code> pour installer toutes les dépendances
du projet, et utilisez les différentes commandes (<code>start</code>,
<code>watch</code> et <code>test</code>) définies dans
<code>package.json</code> pour exécuter et tester votre code.</p>
<h1 id="travail-à-réaliser">Travail à réaliser</h1>
<p>Votre tâche est de compléter toutes les sections de code marquées par
<code>TODO</code> dans ce projet. Vous êtes libres d’ajouter de
nouvelles méthodes ou fonctions, ainsi que de nouveaux tests, si cela
vous parait utile.</p>
</main>
</body>
</html>
